{
  "$schema": "https://shadcn-vue.com/schema/registry-item.json",
  "name": "multi-select",
  "type": "registry:component",
  "title": "Select con posibilidad de seleccionar varias opciones",
  "author": "Danilo Le√≥n <dlg9806@gmail.com>",
  "description": "Select con posibilidad de seleccionar varias opciones.",
  "registryDependencies": [
    "command",
    "button",
    "https://https://dano-registry.vercel.app/r/typhography.json"
  ],
  "files": [
    {
      "path": "app/registry/multi-select/MultiSelect.vue",
      "content": "<script setup lang=\"ts\">\nimport type { MultiSelectDataProp } from '~~/shared/types/app'\nimport { Command, CommandEmpty, CommandInput, CommandList } from '@/components/ui/command'\nimport Typography from '@/registry/typhography/Typography.vue'\nimport MultiSelectActions from './MultiSelectActions.vue'\nimport MultiSelectItem from './MultiSelectItem.vue'\nimport MultiSelectValue from './MultiSelectValue.vue'\nimport { useSelection } from './useSelection'\n\nconst { data, config = {\n  emptyMessage: 'Seleccione una o varias opciones',\n  emptySearchMessage: 'No se encontraron resultados',\n  searchPlaceholder: 'Buscar...',\n} } = defineProps<{\n  data: MultiSelectDataProp[]\n  config?: {\n    emptyMessage: string\n    emptySearchMessage: string\n    searchPlaceholder: string\n  }\n}>()\n\nconst field = defineModel<string[]>({\n  default: () => [],\n})\n\nconst { onSelect, onRemove, selected, initial } = useSelection(data)\n\nconst expanded = ref(false)\nconst isAllSelected = computed(() => selected.value.length === initial.value.flatMap(group => group.items).length)\n\nfunction onMark(mark: boolean) {\n  if (mark === true) {\n    selected.value = initial.value.flatMap(group => group.items)\n  }\n  else {\n    selected.value = []\n  }\n}\n\nwatchEffect(() => {\n  field.value = selected.value.map(item => item.value)\n})\n</script>\n\n<template>\n  <Command class=\"rounded-sm\">\n    <div class=\"w-full py-1.5 relative px-2 border-b border-primary-foreground/10 flex items-center justify-start gap-2 flex-wrap\" :class=\"[expanded ? 'max-h-auto' : 'max-h-9 overflow-hidden']\">\n      <template v-if=\"selected.length > 1\">\n        <MultiSelectValue v-for=\"(item, index) in selected\" :key=\"index\" :item=\"item\" :on-remove=\"onRemove\">\n          {{ item.value }}\n        </MultiSelectValue>\n        <MultiSelectActions v-model=\"expanded\" :selected=\"selected.length\" :marked=\"isAllSelected\" @mark=\"onMark\" />\n      </template>\n      <template v-else-if=\"selected.length === 1\">\n        <MultiSelectValue :item=\"selected[0] as MultiSelectItemProp\" :on-remove=\"onRemove\">\n          {{ selected[0]?.value }}\n        </MultiSelectValue>\n      </template>\n      <template v-else>\n        <div>\n          <Typography variant=\"span\" :text=\"config.emptyMessage\" />\n        </div>\n      </template>\n    </div>\n    <CommandInput :placeholder=\"config.searchPlaceholder\" class=\"w-full\" />\n    <CommandList>\n      <CommandEmpty>{{ config.emptySearchMessage }}</CommandEmpty>\n      <CommandGroup v-for=\"(group, index) in initial\" :key=\"index\" :heading=\"group.heading\" class=\"space-y-1\">\n        <MultiSelectItem\n          v-for=\"item in group.items\"\n          :key=\"item.value\"\n          :items=\"group.items\"\n          :item\n          :checked=\"selected.some(badge => badge.value === item.value)\"\n          @select=\"onSelect\"\n        />\n      </CommandGroup>\n    </CommandList>\n  </Command>\n</template>\n",
      "type": "registry:ui"
    },
    {
      "path": "app/registry/multi-select/MultiSelectActions.vue",
      "content": "<script setup lang=\"ts\">\nimport { ArrowDown, ArrowUp, CheckSquare, CheckSquare2 } from 'lucide-vue-next'\nimport { Button } from '@/components/ui/button'\n\nconst { selected, marked } = defineProps<{\n  selected: number\n  marked: boolean\n}>()\n\nconst emit = defineEmits<{\n  (e: 'mark', value: boolean): void\n}>()\n\nconst open = defineModel<boolean>({\n  default: false,\n})\n</script>\n\n<template>\n  <div class=\"absolute top-1 right-1 flex flex-col items-center justify-center gap-1\">\n    <Button v-if=\"selected > 3\" size=\"icon-xs\" @click=\"() => open = !open\">\n      <component :is=\"open ? ArrowUp : ArrowDown\" class=\"text-primary-foreground cursor-pointer\" />\n    </Button>\n    <Button v-if=\"open && selected > 2\" size=\"icon-xs\" class=\"text-[10px] text-primary-foreground/70 px-1\">\n      {{ selected }}\n    </Button>\n    <Button v-if=\"open && selected > 3\" size=\"icon-xs\" class=\"text-xs text-primary-foreground/70 p-0.5\" @click=\"emit('mark', !marked)\">\n      <component :is=\"marked ? CheckSquare : CheckSquare2\" class=\"text-primary-foreground cursor-pointer size-3\" />\n    </Button>\n  </div>\n</template>\n",
      "type": "registry:ui"
    },
    {
      "path": "app/registry/multi-select/MultiSelectItem.vue",
      "content": "<script setup lang=\"ts\">\nimport { Check } from 'lucide-vue-next'\nimport Typography from '@/registry/typhography/Typography.vue'\nimport CommandItem from '~/components/ui/command/CommandItem.vue'\n\nconst { item, checked } = defineProps<{\n  item: MultiSelectItemProp\n  checked: boolean\n}>()\n\nconst emit = defineEmits<{\n  (e: 'select', value: string): void\n}>()\n</script>\n\n<template>\n  <CommandItem :key=\"item.value\" :value=\"item.value\" class=\"min-h-7\" @select=\"emit('select', item.value)\">\n    <Check v-if=\"checked\" class=\"text-muted-foreground\" />\n    <Typography variant=\"span\" :text=\"item.text\" :class=\"[checked ? 'ml-0' : 'ml-6']\" />\n  </CommandItem>\n</template>\n",
      "type": "registry:ui"
    },
    {
      "path": "app/registry/multi-select/MultiSelectValue.vue",
      "content": "<script setup lang=\"ts\">\nimport { X } from 'lucide-vue-next'\nimport { Button } from '@/components/ui/button'\n\nconst { item, withRemove = true, onRemove } = defineProps<{\n  item: MultiSelectItemProp\n  withRemove?: boolean\n  onRemove: (value: string) => void\n}>()\n</script>\n\n<template>\n  <Button class=\"flex items-center justify-between gap-2 rounded-full text-xs p-0 m-0 h-6 max-w-full\" size=\"sm\" @click=\"onRemove(item.value)\">\n    <span class=\"truncate\">{{ item.text }}</span>\n    <X v-if=\"withRemove\" class=\"text-primary-foreground cursor-pointer\" />\n  </Button>\n</template>\n",
      "type": "registry:ui"
    },
    {
      "path": "app/registry/multi-select/useSelection.ts",
      "content": "import type { MultiSelectItemProp } from '~~/shared/types/app'\n\nexport function useSelection(initialValue: MultiSelectDataProp[]) {\n  function dedupe(items: MultiSelectItemProp[]) {\n    const seen = new Set()\n    return items.filter((item) => {\n      if (seen.has(item.value)) {\n        return false\n      }\n      seen.add(item.value)\n      return true\n    })\n  }\n\n  const initial = ref(initialValue.map(data => ({\n    heading: data.heading,\n    items: dedupe(data.items),\n  })))\n  const selected = ref<Array<MultiSelectItemProp>>([])\n\n  function onSelect(value: string) {\n    const index = selected.value.findIndex(item => item.value === value)\n    if (index !== -1) {\n      selected.value.splice(index, 1)\n      return\n    }\n    const item = initial.value.flatMap(group => group.items).find(item => item.value === value)\n    if (item) {\n      selected.value.push(item)\n    }\n  }\n\n  function onRemove(value: string) {\n    const index = selected.value.findIndex(item => item.value === value)\n    if (index !== -1) {\n      selected.value.splice(index, 1)\n    }\n  }\n\n  return {\n    initial,\n    selected,\n    onSelect,\n    onRemove,\n  }\n}\n",
      "type": "registry:hook"
    }
  ]
}